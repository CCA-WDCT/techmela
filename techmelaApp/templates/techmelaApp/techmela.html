{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TechMela</title>

    <link rel="icon" type="image/png" href="{% static 'techmelaApp/img/final-logo.png' %}">
    <link href='https://fonts.googleapis.com/css?family=Aclonica' rel='stylesheet'>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel="stylesheet" href="{% static 'techmelaApp/css/techmela.css' %}">

    <script src="https://kit.fontawesome.com/c3db3ba7c7.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" media="screen" href="{% static 'techmelaApp/css/particlejs.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">

    <script src="https://kit.fontawesome.com/c3db3ba7c7.js" crossorigin="anonymous"></script>

</head>
<body>
<div id="particles-js"></div>
<button id="launchModal" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
        style="display: none;">
    Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade modal-fullscreen-sm-down" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title container-fluid modalPrjTitle" id="exampleModalLabel"
                    style="text-align: center;font-weight: bold; font-size: 20px;">Project title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-5">
                            <!--  video-->
                            <div class="projectVideo">
                                <iframe id="modalPrjVideo" class="prjVideo"
                                        src="">
                                </iframe>
                                <iframe id="modalPrjPdf" class="prjVideo"
                                        src="">
                                </iframe>
                            </div>
                        </div>
                        <div class="col-md-2"></div>
                        <div class="col-md-5">
                            {% if user.is_judge %}
                                <a id="judgeModalAnchor" onclick="giveScores()"
                                   style=" text-decoration: none; cursor: pointer;">
                                    <div style=" margin-top: 2vh;margin-bottom: 10%;">
                                        <div style="display: inline; color: white;margin-top: 10px; margin-left:10px;background-color: #F7413E;padding: 20px;">
                                            GIVE SCORES
                                        </div>
                                    </div>
                                </a>
                            {% endif %}
                            <!--  desc-->
                            <p id="modalPrjDesc">Project Description</p>

                            <a id="pdfDownloadAnchor" target="_blank" href="#" style=" text-decoration: none;">
                                <div style=" margin-top: 2vh;">
                                    <i style="font-size: 2rem; color: red;" class="far fa-file-pdf"></i>
                                    <div style="display: inline; color: dodgerblue;margin-top: 10px; margin-left:10px;position: absolute;">
                                        Download full details of the project
                                    </div>
                                </div>
                            </a>


                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% if user.is_judge %}
    <button id="launchModal2" type="button" class="btn btn-primary" data-bs-toggle="modal"
            data-bs-target="#exampleModal2"
            style="display: none;">
        Launch demo modal
    </button>

    <!-- Modal -->
    <div class="modal fade modal-fullscreen-sm-down" id="exampleModal2" tabindex="-1"
         aria-labelledby="exampleModalLabel2"
         aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title container-fluid modalPrjTitle" id="exampleModalLabel2"
                        style="text-align: center;font-weight: bold; font-size: 20px;">Give Score</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-2"></div>
                            <div class="col-md-8">
                                <div class="scoreCriteria">
                                    Judging Criteria:
                                </div>
                                <div class="scorePoints">
                                    1. Presentation
                                </div>
                                <div class="scorePoints">
                                    2. Creativity
                                </div>
                                <div class="scorePoints">
                                    3. Execution
                                </div>
                                <div class="scorePoints">
                                    4. Design and Methodology
                                </div>
                                <div class="scorePoints">
                                    5. Social Benefits of project
                                </div>
                                <div class="scorePoints">
                                    6. Marketing possibility
                                </div>
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-2"></div>
                            <div class="col-md-8" style="text-align: center;">
                                <div class="form-group c ">
                                    <label for="inputScore"
                                           style="margin-bottom: 1vh;margin-top: 1vh;font-size: 15px;text-align: center;">Score
                                        out of 10</label>
                                    <input style="text-align: center; padding: 10px;" type="number"
                                           class="form-control" id="inputScore" name="score"
                                           aria-describedby="emailHelp"
                                           placeholder="Enter Score out of 10" max="10" required>
                                    <input style="text-align: center; padding: 10px;display: none;" type="text"
                                           class="form-control" id="inputPrjID" name="prjID"
                                           aria-describedby="emailHelp"
                                           placeholder="project ID" required>
                                </div>
                                <button onclick="markProjectScores()" class="btn btn-danger"
                                        style="background-color: #F7413E;margin-bottom: 3vh;">Submit Score
                                </button>
                                <div id="scoreSubmitSuccessMsg" style="color: dodgerblue;display: none;">Scores
                                    submitted successfully.
                                </div>
                                <div id="scoreAlreadySubmittedMsg" style="color: red;display: none;">Scores already
                                    submitted.
                                </div>
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endif %}


<div>
    <div class="mainHeading" style="text-align: center; ">
        <img class="techmelaTitleImg" src="{% static 'techmelaApp/img/techmelaTitle.png' %}" alt="techmela-title"/>
    </div>
    <h5 class="mainSubheading" style="text-align: center;">Aarohan 2021 presents TechMela</h5>
    {% if user.is_authenticated %}
        <div style="text-align: center;margin-bottom: 2%; ">
            <div style="color: dodgerblue;">Welcome!! {{ user.username }}</div>
            <a href="{% url 'logout' %}" style="text-decoration: none;">
                <button type="button" class="btn btn-warning reg" style="background-color: #DE8F4F;">Log Out
                </button>
            </a>
        </div>
    {% else %}
        <div style="text-align: center;margin-bottom: 2%; ">
            <a href="{% url 'signup' %}" style="text-decoration: none;">
                <button type="button" class="btn" style="background-color: #AFD27F;">Sign Up
                </button>
            </a>
            <a href="{% url 'login' %}" style="text-decoration: none;">
                <button type="button" class="btn" style="background-color: #DE8F4F;">Log In
                </button>
            </a>
        </div>
    {% endif %}
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist" style="text-align: center;">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home"
                    type="button" role="tab" aria-controls="pills-home" aria-selected="true">Robotics
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile"
                    type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Assistive Technology
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact"
                    type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Software Projects
            </button>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">

        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
            <div class="sectionHeading" style="text-align: center;">
                Robotics
            </div>


            <div class="container-fluid">
                <div class="row">
                    <div class="col"></div>
                    <div class="col-md-10">
                        <div class="page-content">
                            {% for project in allProjects %}
                                {% if project.category == '1' %}
                                    <div class="card"
                                         style="background-image: url('http://127.0.0.1:8000/media/{{ project.image }} ')" >
                                        <div class="content">
                                            <h2 class="title">{{ project.title }}</h2>
                                            <p class="copy">{{ project.shortDescription }}</p>
                                            <button onclick="showDetails('{{ project.id }}' ,'{{ project.title }}','{{ project.mainDescription }}','{{ project.videoLink }}','{{ project.pdfLink }}')"
                                                    class="btn detailsButton">Show Details
                                            </button>

                                            {% if user.is_authenticated %}

                                                <input style="text-align: center; padding: 10px;display: none;"
                                                       type="text"
                                                       class="form-control" id="inputPrjIDLike" name="prjIDLike"
                                                       value="{{ project.id }}"
                                                       aria-describedby="emailHelp"
                                                       placeholder="project ID" required>

                                                <a
                                                        onclick="likePressed('{{ project.id }}', '{{ project.likes }}')">
                                                    <i id="likeButton"
                                                       class="fas fa-heart"></i><span
                                                        id="numberOfLikes{{ project.id }}">{{ project.likes }}</span></a>

                                            {% endif %}

                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col"></div>
                </div>
            </div>

        </div>


        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
            <div class="sectionHeading" style="text-align: center;">
                Assistive Technology
            </div>

            <div class="container-fluid">
                <div class="row">
                    <div class="col"></div>
                    <div class="col-md-10">
                        <div class="page-content">
                            {% for project in allProjects %}
                                {% if project.category == '2' %}
                                    <div class="card"
                                         style="background-image: url(https://techmela.arhn.co.in/media/{{ project.image }});background-size: cover;">
                                        <div class="content">
                                            <h2 class="title">{{ project.title }}</h2>
                                            <p class="copy">{{ project.shortDescription }}</p>
                                            <button onclick="showDetails('{{ project.id }}' ,'{{ project.title }}','{{ project.mainDescription }}','{{ project.videoLink }}','{{ project.pdfLink }}')"
                                                    class="btn detailsButton">Show Details
                                            </button>

                                            {% if user.is_authenticated %}

                                                <input style="text-align: center; padding: 10px;display: none;"
                                                       type="text"
                                                       class="form-control" id="inputPrjIDLike" name="prjIDLike"
                                                       value="{{ project.id }}"
                                                       aria-describedby="emailHelp"
                                                       placeholder="project ID" required>

                                                <a
                                                        onclick="likePressed('{{ project.id }}', '{{ project.likes }}')">
                                                    <i id="likeButton"
                                                       class="fas fa-heart"></i><span
                                                        id="numberOfLikes{{ project.id }}">{{ project.likes }}</span></a>

                                            {% endif %}

                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col"></div>
                </div>
            </div>
        </div>


        <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
            <div class="sectionHeading" style="text-align: center;">
                Software Projects
            </div>

            <div class="container-fluid">
                <div class="row">
                    <div class="col"></div>
                    <div class="col-md-10">
                        <div class="page-content">
                            {% for project in allProjects %}
                                {% if project.category == '3' %}
                                    <div class="card"
                                         style="background-image: url(https://techmela.arhn.co.in/media/{{ project.image }});background-size: cover;">
                                        <div class="content">
                                            <h2 class="title">{{ project.title }}</h2>
                                            <p class="copy">{{ project.shortDescription }}</p>
                                            <button onclick="showDetails('{{ project.id }}' ,'{{ project.title }}','{{ project.mainDescription }}','{{ project.videoLink }}','{{ project.pdfLink }}')"
                                                    class="btn detailsButton">Show Details
                                            </button>

                                            {% if user.is_authenticated %}

                                                <input style="text-align: center; padding: 10px;display: none;"
                                                       type="text"
                                                       class="form-control" id="inputPrjIDLike" name="prjIDLike"
                                                       value="{{ project.id }}"
                                                       aria-describedby="emailHelp"
                                                       placeholder="project ID" required>

                                                <a
                                                        onclick="likePressed('{{ project.id }}', '{{ project.likes }}')">
                                                    <i id="likeButton"
                                                       class="fas fa-heart"></i><span
                                                        id="numberOfLikes{{ project.id }}">{{ project.likes }}</span></a>

                                            {% endif %}

                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col"></div>
                </div>
            </div>
        </div>

    </div>
</div>
<div class="container-fluid">
    <div class="footerInfo">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-1">
                {#                <a href="https://ccanitd.in">#}
                {#                <img style="height: 70px; width: 70px;" src="{% static 'techmelaApp/img/NEW-CCA-Logo_Colored.png' %}" alt="cca-logo" />#}
                {#                    </a>#}
            </div>
            <div class="col-md-1">
                {#                <a href="https://ccanitd.in">#}
                {#                <img style="height: 70px; width: 70px;" src="{% static 'techmelaApp/img/WDCT_logo_white.png' %}" alt="cca-logo" />#}
                {#                </a>#}
            </div>
            <div class="col-md-6">
                <div style="margin-top: 2%;margin-left: -70px;">
                    <a href="https://ccanitd.in" style="text-decoration: none;color: white;">
                        TechMela presented by <img style="height: 70px; width: 70px; position: absolute;top:-20px;"
                                                   src="{% static 'techmelaApp/img/final-logo.png' %}" alt="cca-logo"/>
                    </a>
                </div>
            </div>
        </div>
        ️
    </div>
</div>
<div class="container-fluid">
    <div class="">

        <a href="https://ccanitd.in">
            <img class="footerWdctLogo" style=""
                 src="{% static 'techmelaApp/img/WDCT_logo_white.png' %}" alt="cca-logo"/>
        </a>
    </div>
</div>
<div class="container-fluid" style="padding-bottom: 5vh;">
    <div class="footerInfo">
        <div class="footerWdctText" style="float: right;">
                    <a href="https://ccanitd.in" style="text-decoration: none;color: white;">
                       Developed by WDCT
                    </a>
                </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>

<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    var scoreProj;
    const showDetails = (prjID, prjTitle, prjDesc, prjVideo, prjPdf) => {
        console.log("Show Details", prjID, prjTitle, prjDesc, prjVideo);
        scoreProj = prjID;
        document.getElementById("exampleModalLabel").innerText = prjTitle;
        document.getElementById("modalPrjVideo").setAttribute("src", prjVideo);
        document.getElementById("modalPrjPdf").setAttribute("src", prjPdf);
        document.getElementById("modalPrjDesc").innerText = prjDesc;
        document.getElementById("pdfDownloadAnchor").setAttribute("href", prjPdf);
        document.getElementById("launchModal").click();
    };
    let b = document.querySelector('button');
    setTimeout(() => b.focus(), 100);
    setTimeout(() => b.blur(), 1000);

    const likePressed = async (prjID, noOfLikes) => {
        var likeNumberID = "numberOfLikes" + prjID;
        var requestOptions = {
            'method': 'POST',
            'headers': new Headers({
                'X-CSRFToken': csrftoken,
                'Content-Type': 'application/json',
            }),
            mode: 'same-origin',
            body: JSON.stringify({
                'prjID': prjID,
            })
        };
        await fetch("/like", requestOptions)
            .then(response => response.text())
            .then(result => {
                result = JSON.parse(result);
                var likes = parseInt(noOfLikes);
                if (result.isLiked && result.isSuccess) {
                    likes = likes + 1;
                    document.getElementById(likeNumberID).innerHTML = likes;
                } else if (!result.isLiked && result.isSuccess) {
                    likes = likes - 1;
                    if (likes < 0)
                        likes = 0;
                    document.getElementById(likeNumberID).innerHTML = likes;
                }
            })
            .catch(error => console.error('error', error));

    };

    {% if user.is_judge %}
        const giveScores = () => {
            $('#exampleModal').modal('toggle');
            document.getElementById("inputPrjID").value = scoreProj;
            document.getElementById("launchModal2").click();

        };
        $('#exampleModal2').on('hidden.bs.modal', function () {
            $('#exampleModal').modal('toggle');
            document.getElementById("scoreSubmitSuccessMsg").style.display = 'none';
            document.getElementById("scoreAlreadySubmittedMsg").style.display = 'none';
        });

        const markProjectScores = async () => {
            var score = document.getElementById('inputScore').value;
            console.log("#####", score);
            var requestOptions = {
                'method': 'POST',
                'headers': new Headers({
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/json',
                }),
                mode: 'same-origin',
                body: JSON.stringify({
                    'score': score,
                    'prjID': scoreProj,
                })
            };
            await fetch("/score", requestOptions)
                .then(response => response.text())
                .then(result => {
                    result = JSON.parse(result);
                    if (result.isSuccess && !result.alreadySubmitted) {
                        document.getElementById("scoreSubmitSuccessMsg").style.display = 'block';
                    }
                    if (result.alreadySubmitted) {
                        document.getElementById("scoreAlreadySubmittedMsg").style.display = 'block';
                    }
                })
                .catch(error => console.error('error', error));
        };
    {% endif %}
</script>
<script src='https://cldup.com/S6Ptkwu_qA.js'></script>
<script src="{% static 'techmelaApp/js/particlejs1.js' %}"></script>
</body>
</html>